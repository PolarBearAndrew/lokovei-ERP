extends layout

block content
  link(rel="stylesheet", href="stylesheets/queue_factory.css")
  script(src="javascript/queue_factory.js")
  script(src="javascript/queue_factory_drag.js")
  .screen
    .wrapper
      - var lineCount = lineData.length;
      //-  left title , line data
      .day
        - for( var l = 0; l < lineCount ; l++ )
          - if( l == 0 )
            .thumbnail.dayTitle
              h4 產線訂單佇列表
          .line
            //- line info data
            .thumbnail.lineName
              h4= '產線：' + lineData[l].name
              p
                = lineData[l].who
                br
                = lineData[l].phone

      - var d = new Date()
      - var index = 0; //- index is using on change day
      - for( var day = 0; day < 3; day++ )
        .day
          - for( var line = 0; line < lineCount; line++ )
            - if( line == 0 ) //- title
              .thumbnail.dayTitle
                h4= d.getFullYear() + ' / ' + (d.getMonth() + 1) + ' / ' + ( d.getUTCDate() + day )
            //- show job
            - var time = Math.round(d / 86400000) * 100 + line;
            .line(id='line'+line ondrop="drop(event)" ondragover="allowDrop(event)" data-time= time)
              - for( var j = index; j < all.length; j++ )
                - var job = all[j];
                //- debug
                //- h1= index
                //- h4= job.time
                - if( job.time % 100 != line ){ break; }
                - index++;
                - var id = 'line'+line+'job'+j;
                .thumbnail.job(id=id draggable="true" ondragstart="drag(event)" data-time=job.time data-oid=job.oid data-status=job.status )
                  p
                    = job.pid
                    br
                    = job.pSpec
                    br
                    = '電池：' + job.battery
                    br
                    = '備註：' + job.note
                    br
                    - var uid = { 'data-uid': job._id.toString() + job.time.toString() }
                    - if(job.status == '已結案')
                      button.status.btn.btn-sm.btn-success(data-id=id data-time=job.time data-oid=job.oid data-status=job.status )&attributes(uid)= job.status
                    - else if(job.status == '已出貨')
                      button.status.btn.btn-sm.btn-primary(data-id=id  data-time=job.time data-oid=job.oid data-status=job.status )&attributes(uid)= job.status
                    - else if(job.status == '尚未出貨')
                      button.status.btn.btn-sm.btn-info(data-id=id  data-time=job.time data-oid=job.oid data-status=job.status )&attributes(uid)= job.status
                    - else if(job.status == '尚未完成')
                      button.status.btn.btn-sm.btn-warning(data-id=id  data-time=job.time data-oid=job.oid data-status=job.status )&attributes(uid)= job.status
                    - else if(job.status == '訂單取消')
                      button.status.btn.btn-sm.btn-danger(data-id=id  data-time=job.time data-oid=job.oid data-status=job.status )&attributes(uid)= job.status
                    - else
                      button.status.btn.btn-default(data-id=id  data-time=job.time data-oid=job.oid data-status=job.status )&attributes(uid) 尚未設定
                    - var order = '<p>訂單編號：' + job.oid; //- '<br/>經銷商：' + job. + '<br/>訂單出車日期：2015/5/12</p>'
                    span.info.glyphicon.glyphicon-tags.job-info( aria-hidden='true', tabindex='0', role='button', data-toggle='popover', data-trigger='click', title='訂單資訊', data-html="true", data-content=order)
              - if( index >= all.length ) { index++; }

  #statusDialog.modal.fade.bs-example-modal-sm(tabindex='-1', role='dialog', aria-labelledby='mySmallModalLabel', aria-hidden='true')
    .modal-dialog.modal-sm
      .modal-content
        .modal-header
          button.close(type='button', data-dismiss='modal')
            span(aria-hidden='true') ×
            span.sr-only Close
          h4.modal-title 訂單狀況選擇
        .modal-body
          p
            button.statusChoose.btn.btn-success(style="width: 100%", data-value='已結案') 已結案
          p
            button.statusChoose.btn.btn-primary(style="width: 100%", data-value='已出貨') 已出貨
          p
            button.statusChoose.btn.btn-info(style="width: 100%", data-value='尚未出貨') 尚未出貨
          p
            button.statusChoose.btn.btn-warning(style="width: 100%", data-value='尚未完成') 尚未完成
          p
            button.statusChoose.btn.btn-danger(style="width: 100%", data-value='訂單取消') 訂單取消
          p
            button.statusChoose.btn.btn-default(style="width: 100%", data-value='無狀態') 無狀態
        .modal-footer
          button.btn.btn-default(type='button', data-dismiss='modal') Close

- function getTodayNum(){
-  let minutes = 1000 * 60;
-  let hours = minutes * 60;
-  let days = hours * 24;
-  let d = new Date();
-  let t= d.getTime();
-  return Math.round(t / 86400000); //與 差幾天  January 1, 1970.
- }
